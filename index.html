<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width">
<title>TabularMaps - tabular-map tag</title>
</head><body>

<h1>TabularMaps - tabular-map tag</h1>

<h2>タグのみ</h2>
<script type="module" src="https://code4fukui.github.io/tabular-map/tabular-map.js"></script>
<tabular-map></tabular-map>
<textarea style="width:calc(100% - 1em);height:4em;margin:.5em">&lt;script type="module" src="./tabular-map.js"&gt;&lt;/script&gt;
&lt;tabular-map&gt;&lt;/tabular-map&gt;
</textarea>

<h2>カスタマイズ</h2>

<div id=grayborder></div>
<script type="module">
import { TabularMap } from "https://code4fukui.github.io/tabular-map/tabular-map.js";
import { style } from "https://js.sabae.cc/css.js";

const tmap = new TabularMap();
grayborder.appendChild(tmap);
tmap.style.width = "80vw";
style({
  "#grayborder .tabularmapitem": {
    border: "4px solid gray",
  }
});
tmap.querySelector(".日本").textContent = "カスタマイズ";
tmap.querySelector(".福井 .content").textContent = "鯖江市はココ！";
tmap.querySelector(".東京 .name").style.color = "blue";
</script>

<textarea style="width:calc(100% - 1em);margin:.5em;height:25em">&lt;div id=grayborder&gt;&lt;/div&gt;
&lt;script type="module"&gt;
import { TabularMap } from "./tabular-map.js";
import { style } from "https://js.sabae.cc/css.js";

const tmap = new TabularMap();
grayborder.appendChild(tmap);
tmap.style.width = "80vw";
style({
  "#grayborder .tabularmapitem": {
    border: "4px solid gray",
  }
});
tmap.querySelector(".日本").textContent = "カスタマイズ";
tmap.querySelector(".福井 .content").textContent = "鯖江市はココ！";
tmap.querySelector(".東京 .name").style.color = "blue";
&lt;/script&gt;
</textarea>

<h2>データビジュアライズ</h2>

<div id="fdma"></div>
<script type="module">
import { TabularMap } from "https://code4fukui.github.io/tabular-map/tabular-map.js";
import { CSV } from "https://js.sabae.cc/CSV.js";
import { Num } from "https://js.sabae.cc/Num.js";

window.addEventListener("load", async () => {
  const url = "https://code4fukui.github.io/fdma_go_jp/emergencytransport_difficult_pref.csv";
  const data = CSV.toJSON(await CSV.fetch(url));
  
  const latest = data[data.length - 1];
  const start = latest.開始日;
  const end = latest.終了日;
  const latestdata = data.filter((d) => d.開始日 == latest.開始日);
  
  const tmap = new TabularMap();
  fdma.appendChild(tmap);
  const max = latestdata.reduce((prev, d) => prev > parseInt(d.救急搬送困難事案数) ? prev : parseInt(d.救急搬送困難事案数), 0);
  for (const c of tmap.childNodes) {
    const name = c.childNodes[0].textContent;
    const getCount = () => {
      if (name == "日本") {
        return latestdata.reduce((prev, d) => prev + parseInt(d.救急搬送困難事案数), 0);
      } else {
        return latestdata.find((d) => d.都道府県.startsWith(name))?.救急搬送困難事案数 || "";
      }
    };
    const n = getCount();
    c.childNodes[1].textContent = Num.addComma(n) + "件";
    if (name != "日本" && n > 0) {
      c.style.backgroundColor = `rgba(255, 0, 0, ${.1 + (n / max) * .8})`;
      if (n == max) {
        c.style.color = "white";
      }
    }
  }
});
</script>
<div><a href=https://github.com/code4fukui/fdma_go_jp>code4fukui/fdma_go_jp: 総務省消防庁オープンデータのCSV化</a></div>

</body></html>
